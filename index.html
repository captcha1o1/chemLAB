<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive 3D Molecules</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Mobile Toggle Button -->
    <button class="mobile-toggle" onclick="toggleSidebar()">â˜°</button>

    <!-- Theme Toggle -->
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark/Light Mode">
        <span id="theme-icon">ğŸŒ™</span>
    </button>

    <div id="container">
        <div id="sidebar">
            <!-- Header Section -->
            <div class="header">
                <h1>ğŸ§ª CaptchaLab</h1>
                <p>Interactive 3D Molecular Visualization</p>
            </div>

            <!-- Preset Molecules Section -->
            <div class="section-card">
                <h3>ğŸ“š Preset Molecules <button onclick="toggleMoleculeList()" class="btn btn-secondary" style="float: right; padding: 4px 8px; font-size: 12px;" id="minimize-btn">âˆ’ Minimize</button></h3>
                <div class="molecule-grid" id="molecule-list">
                    <!-- Basic Molecules -->
                    <div style="width: 100%; margin: 10px 0; padding: 8px; background: var(--bg-tertiary); border-radius: 8px; font-weight: 600; color: var(--text-secondary);">ğŸ§¬ Basic Molecules</div>
                    <button class="molecule-btn active" data-molecule="hydrogen">âš¡ Hydrogen (Hâ‚‚)</button>
                    <button class="molecule-btn" data-molecule="oxygen">ğŸ”¥ Oxygen (Oâ‚‚)</button>
                    <button class="molecule-btn" data-molecule="nitrogen">ğŸ’¨ Nitrogen (Nâ‚‚)</button>
                    <button class="molecule-btn" data-molecule="water">ğŸ’§ Water (Hâ‚‚O)</button>
                    <button class="molecule-btn" data-molecule="ammonia">ğŸ§ª Ammonia (NHâ‚ƒ)</button>

                    <!-- Carbon Compounds -->
                    <div style="width: 100%; margin: 10px 0; padding: 8px; background: var(--bg-tertiary); border-radius: 8px; font-weight: 600; color: var(--text-secondary);">âš—ï¸ Carbon Compounds</div>
                    <button class="molecule-btn" data-molecule="methane">âš¡ Methane (CHâ‚„)</button>
                    <button class="molecule-btn" data-molecule="ethylene">ğŸ”— Ethylene (Câ‚‚Hâ‚„)</button>
                    <button class="molecule-btn" data-molecule="acetylene">ğŸ’ Acetylene (Câ‚‚Hâ‚‚)</button>
                    <button class="molecule-btn" data-molecule="carbon_monoxide">â˜ ï¸ Carbon Monoxide (CO)</button>
                    <button class="molecule-btn" data-molecule="carbon-dioxide">ğŸŒ¬ï¸ Carbon Dioxide (COâ‚‚)</button>
                    <button class="molecule-btn" data-molecule="ozone">ğŸŒªï¸ Ozone (Oâ‚ƒ)</button>
                    <button class="molecule-btn" data-molecule="ethanol">ğŸº Ethanol (Câ‚‚Hâ‚…OH)</button>
                    <button class="molecule-btn" data-molecule="benzene">ğŸ”¶ Benzene (Câ‚†Hâ‚†)</button>
                    <button class="molecule-btn" data-molecule="glucose">ğŸ¬ Glucose (Câ‚†Hâ‚â‚‚Oâ‚†)</button>
                    <button class="molecule-btn" data-molecule="acetone">ğŸ§´ Acetone (Câ‚ƒHâ‚†O)</button>
                    <button class="molecule-btn" data-molecule="formaldehyde">âš—ï¸ Formaldehyde (CHâ‚‚O)</button>
                    <button class="molecule-btn" data-molecule="hydrogen-peroxide">ğŸ§´ Hydrogen Peroxide (Hâ‚‚Oâ‚‚)</button>

                    <!-- Phosphorus Compounds -->
                    <div style="width: 100%; margin: 10px 0; padding: 8px; background: var(--bg-tertiary); border-radius: 8px; font-weight: 600; color: var(--text-secondary);">ğŸ”¥ Phosphorus Compounds</div>
                    <button class="molecule-btn" data-molecule="phosphine">â˜£ï¸ Phosphine (PHâ‚ƒ)</button>
                    <button class="molecule-btn" data-molecule="phosphorus_pentachloride">ğŸ§ª PClâ‚…</button>
                    <button class="molecule-btn" data-molecule="phosphorus_pentafluoride">âš—ï¸ PFâ‚…</button>

                    <!-- Halogen Compounds -->
                    <div style="width: 100%; margin: 10px 0; padding: 8px; background: var(--bg-tertiary); border-radius: 8px; font-weight: 600; color: var(--text-secondary);">âš¡ Halogen Compounds</div>
                    <button class="molecule-btn" data-molecule="chlorine_trifluoride">ğŸ§ª ClFâ‚ƒ</button>
                    <button class="molecule-btn" data-molecule="bromine_pentafluoride">ğŸ§ª BrFâ‚…</button>
                    <button class="molecule-btn" data-molecule="sulfur_hexafluoride">ğŸ§ª SFâ‚†</button>

                    <!-- Noble Gas Compounds -->
                    <div style="width: 100%; margin: 10px 0; padding: 8px; background: var(--bg-tertiary); border-radius: 8px; font-weight: 600; color: var(--text-secondary);">ğŸ‘‘ Noble Gas Compounds</div>
                    <button class="molecule-btn" data-molecule="xenon_difluoride">ğŸ§ª XeFâ‚‚</button>
                    <button class="molecule-btn" data-molecule="xenon_oxytetrafluoride">ğŸ§ª XeOFâ‚„</button>
                    <button class="molecule-btn" data-molecule="krypton_difluoride">ğŸ§ª KrFâ‚‚</button>
                </div>
            </div>

            <!-- AI Generator Section -->
            <div class="section-card">
                <h3>ğŸ¤– AI Molecule Generator</h3>
                <textarea id="ai-description" placeholder="Describe molecule in plain English (e.g., 'water molecule with oxygen and two hydrogens')" style="width: 100%; padding: 12px 16px; margin: 12px 0; border: 1px solid var(--border-color); border-radius: 12px; background: var(--bg-secondary); color: var(--text-primary); height: 90px; transition: var(--transition);"></textarea>
                <div class="button-group">
                    <button id="generate-ai" class="btn btn-warning" style="flex: 1;">
                        âš¡ Generate with AI
                    </button>
                    <button onclick="clearAI()" class="btn btn-secondary" title="Clear AI input">
                        ğŸ—‘ï¸
                    </button>
                </div>
            </div>

            <!-- Custom Molecule Section -->
            <div class="section-card">
                <h3>ğŸ”§ Custom Molecule</h3>
                <input type="text" id="custom-name" placeholder="Molecule Name" style="width: 100%; padding: 12px 16px; margin: 12px 0; border: 1px solid var(--border-color); border-radius: 12px; background: var(--bg-secondary); color: var(--text-primary); transition: var(--transition);" />
                <input type="text" id="custom-formula" placeholder="Chemical Formula" style="width: 100%; padding: 12px 16px; margin: 12px 0; border: 1px solid var(--border-color); border-radius: 12px; background: var(--bg-secondary); color: var(--text-primary); transition: var(--transition);" />
                <textarea id="custom-description" placeholder="Description" style="width: 100%; padding: 12px 16px; margin: 12px 0; border: 1px solid var(--border-color); border-radius: 12px; background: var(--bg-secondary); color: var(--text-primary); height: 70px; transition: var(--transition); resize: vertical;"></textarea>
                <textarea id="custom-structure" placeholder="Atoms:
C 0 0 0
H 1 0 0
O 0 1 0

Bonds:
0-1 single
0-2 double" style="width: 100%; padding: 12px 16px; margin: 12px 0; border: 1px solid var(--border-color); border-radius: 12px; background: var(--bg-secondary); color: var(--text-primary); height: 160px; font-family: 'JetBrains Mono', 'Fira Code', monospace; transition: var(--transition); resize: vertical;"></textarea>

                <div class="button-group">
                    <button id="create-custom" class="btn btn-primary" style="flex: 1;">
                        âœ¨ Create Molecule
                    </button>
                    <button onclick="clearCustom()" class="btn btn-secondary" title="Clear custom input">
                        ğŸ—‘ï¸
                    </button>
                </div>
            </div>

            <!-- Settings -->
            <div class="section-card">
                <h3>âš™ï¸ Settings</h3>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-size: 14px; color: var(--text-primary);">
                        Sidebar Width: <span id="width-value">320px</span>
                    </label>
                    <input type="range" id="sidebar-width" min="250" max="500" value="320" step="10"
                           style="width: 100%; height: 6px; border-radius: 3px; background: var(--border-color); outline: none; -webkit-appearance: none;"
                           oninput="updateSidebarWidth(this.value)">
                </div>
                <div class="button-group">
                    <button onclick="resetSidebarWidth()" class="btn btn-secondary" title="Reset sidebar width">
                        ğŸ”„ Reset Width
                    </button>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="section-card">
                <h3>âš¡ Quick Actions</h3>
                <div class="button-grid">
                    <button onclick="exportData()" class="btn btn-success" title="Export molecule data">
                        ğŸ’¾ Export
                    </button>
                    <button onclick="randomMolecule()" class="btn btn-warning" title="Load random molecule">
                        ğŸ² Random
                    </button>
                    <button onclick="duplicateMolecule()" class="btn btn-secondary" title="Duplicate current molecule">
                        ğŸ“‹ Copy
                    </button>
                    <button onclick="resetAll()" class="btn btn-danger" title="Reset everything">
                        ğŸ”„ Reset
                    </button>
                </div>
            </div>
        </div>

        <div id="viewer">
            <!-- Stats Panel -->
            <div class="stats-panel">
                <div class="stat-item">
                    <span>Atoms:</span>
                    <span class="stat-value" id="atom-count">3</span>
                </div>
                <div class="stat-item">
                    <span>Bonds:</span>
                    <span class="stat-value" id="bond-count">2</span>
                </div>
                <div class="stat-item">
                    <span>Elements:</span>
                    <span class="stat-value" id="element-count">2</span>
                </div>
                <div class="stat-item">
                    <span>Status:</span>
                    <span class="stat-value" id="molecule-status">Loaded</span>
                </div>
            </div>

            <div class="loading">
                <div class="spinner"></div>
                <p>Loading 3D viewer...</p>
            </div>

            <div id="info">
                <h3 id="molecule-name">ğŸ’§ Water</h3>
                <p id="molecule-formula">Hâ‚‚O</p>
                <p id="molecule-description">Water is a polar molecule essential for life on Earth with bent molecular geometry.</p>
            </div>

            <!-- AI Analysis Panel (positioned below info panel) -->
            <div id="ai-analysis" style="display: none; position: absolute; top: 200px; right: 20px; background: var(--bg-secondary); backdrop-filter: blur(20px); padding: 20px; border-radius: 16px; max-width: 320px; max-height: 400px; border: 1px solid var(--border-color); box-shadow: var(--shadow); transition: var(--transition); z-index: 10;">
                <h4 style="margin: 0 0 15px 0; color: var(--text-secondary); display: flex; align-items: center; gap: 8px;">
                    ğŸ“Š AI Analysis
                    <button onclick="hideAIAnalysis()" class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;">âœ•</button>
                </h4>
                <div id="ai-details" style="font-size: 12px; line-height: 1.5; color: var(--text-primary); max-height: 320px; overflow-y: auto;"></div>
            </div>

            <div class="controls">
                <button onclick="toggleRotation()" title="Toggle auto-rotation">
                    ğŸ”„ Rotation
                </button>
                <button onclick="resetView()" title="Reset camera view">
                    ğŸ¯ Reset View
                </button>
                <button onclick="toggleLabels()" title="Show/hide atom labels">
                    ğŸ·ï¸ Labels
                </button>
                <button onclick="toggleFullscreen()" title="Toggle fullscreen">
                    â›¶ Fullscreen
                </button>
                <button onclick="takeScreenshot()" title="Take screenshot">
                    ğŸ“¸ Screenshot
                </button>
            </div>
        </div>
    </div>

    <!-- Help Modal (Hidden by default) -->
    <div id="help-modal" class="modal hidden">
        <div class="modal-content">
            <h2>ğŸ§ª MoleculeLab Help</h2>
            <div class="help-content">
                <h3>Getting Started</h3>
                <p>Use the sidebar to select preset molecules or create your own using AI or manual input.</p>

                <h3>AI Generation</h3>
                <p>Describe any molecule in plain English and let AI generate the 3D structure and analysis.</p>

                <h3>Controls</h3>
                <ul>
                    <li><strong>Mouse:</strong> Rotate, zoom, and pan the molecule</li>
                    <li><strong>Rotation:</strong> Toggle auto-rotation on/off</li>
                    <li><strong>Labels:</strong> Show element symbols on atoms</li>
                    <li><strong>Reset:</strong> Return to default view</li>
                </ul>

                <h3>Custom Molecules</h3>
                <p>Use the format:<br>
                <code>Atoms:<br>Element X Y Z<br>Bonds:<br>atom1-atom2 type</code></p>
            </div>
            <button onclick="closeHelp()" class="btn btn-primary">Got it!</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="script.js"></script>
</body>
</html>
